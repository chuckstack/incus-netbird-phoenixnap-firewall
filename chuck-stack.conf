#!/usr/sbin/nft -f

# This configuration blocks all incoming traffic except through Netbird
table inet chuck-stack {
    chain input {
        type filter hook input priority 0; policy accept;

        # Allow established connections
        ct state related,established accept

        # Allow loopback
        iifname "lo" accept

        # Allow Netbird interface (redundant since policy is accept, but explicit)
        iifname "wt0" accept

        # Allow incus bridge (redundant since policy is accept, but explicit)
        iifname "incusbr0" accept

        # Drop traffic from bond0 and its VLANs (public interfaces)
        iifname "bond0*" drop

        # Drop traffic from physical interfaces
        iifname "enp1s0f*" drop
    }
}

# Add any additional custom rules below as needed
# to add: sudo nft -f chuck-stack-2.conf
# to drop: sudo nft delete table inet chuck-stack

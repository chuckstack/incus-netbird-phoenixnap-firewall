# Define the custom table
table inet chuck-stack {
    # Define a chain to handle traffic coming into the server via NF_INET_PRE_ROUTING
    chain input {
        type filter hook input priority filter; policy drop;

        # Allow traffic on the loopback interface
        iifname "lo" accept

        # Allow related and established sessions
        ct state related,established accept

        # Allow traffic from the Netbird interface (e.g., wt0)
        iifname "wt0" accept
    }

    # Define a chain to manage forwarding traffic
    chain forward {
        type filter hook forward priority filter; policy drop;

        # Allow forwarding traffic that is related or established
        ct state related,established accept

        # Allow traffic from or to the Netbird interface
        iifname "wt0" accept
        oifname "wt0" accept
    }

    # Define a chain to handle outgoing traffic
    chain output {
        type filter hook output priority filter; policy accept;

        # Generally allow outgoing traffic (custom restrictions can be added as needed)
        # Additional outgoing restrictions can be configured here
    }
}

# Add any additional custom rules below as needed
# to drop: sudo nft delete table inet chuck-stack
